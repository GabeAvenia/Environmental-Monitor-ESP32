[platformio]
; Set the default environment for normal builds (Upload button)
default_envs = esp32dev

[env:esp32dev]
platform = espressif32
board = adafruit_qtpy_esp32s3_n4r2
framework = arduino
monitor_speed = 115200
lib_deps = 
    adafruit/Adafruit NeoPixel@^1.12.4
    adafruit/Adafruit SHT4x Library@^1.0.4
    vrekrer/Vrekrer SCPI parser@^0.5.0
    bblanchon/ArduinoJson@^7.3.1
    adafruit/Adafruit BusIO
    adafruit/Adafruit Unified Sensor
    SPI
    adafruit/Adafruit Si7021 Library@^1.5.3
    adafruit/Adafruit MAX31865 library@^1.6.2
board_build.filesystem = littlefs
build_flags = 
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1
    -D CONFIG_LITTLEFS_SPIFFS_COMPAT=1
    -std=gnu++17
    -DLOG_LOCAL_LEVEL=ESP_LOG_NONE
build_unflags = -std=gnu++11

[env:test]
platform = espressif32
board = adafruit_qtpy_esp32s3_n4r2
framework = arduino
monitor_speed = 115200
lib_deps = 
    adafruit/Adafruit NeoPixel@^1.12.4
    adafruit/Adafruit SHT4x Library@^1.0.4
    vrekrer/Vrekrer SCPI parser@^0.5.0
    bblanchon/ArduinoJson@^7.3.1
    adafruit/Adafruit BusIO
    adafruit/Adafruit Unified Sensor
    SPI
    adafruit/Adafruit Si7021 Library@^1.5.3
    adafruit/Adafruit MAX31865 library@^1.6.2
board_build.filesystem = littlefs
build_flags = 
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1
    -D CONFIG_LITTLEFS_SPIFFS_COMPAT=1
    -std=gnu++17
    -DLOG_LOCAL_LEVEL=ESP_LOG_NONE
    -DCONFIG_UNITY_FREERTOS_STACK_SIZE=10240
    -DCONFIG_FREERTOS_UNICORE=1
build_unflags = -std=gnu++11
test_build_src = yes
build_src_filter = +<*> -<main.cpp>